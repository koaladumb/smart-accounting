<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Accounting V14.3 - Lite Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-slate-100 p-4 md:p-8" x-data="accountingSystem()" x-init="init()">

    <div class="max-w-7xl mx-auto">
        <header class="mb-6 flex flex-col md:flex-row justify-between items-center bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
            <div>
                <h1 class="text-3xl font-black text-slate-800 tracking-tight italic uppercase">Smart<span class="text-indigo-600 font-normal">Accounting</span></h1>
                <p class="text-slate-400 text-[10px] font-bold uppercase tracking-[0.2em]">V14.3 - Clean & Minimalist</p>
            </div>
            <div class="flex flex-wrap gap-2 mt-4 md:mt-0">
                <button @click="downloadBackup" class="bg-indigo-600 text-white px-4 py-2 rounded-xl text-xs font-bold hover:bg-indigo-700">üíæ BACKUP</button>
                <label class="bg-amber-500 text-white px-4 py-2 rounded-xl text-xs font-bold hover:bg-amber-600 cursor-pointer">
                    üìÇ RESTORE <input type="file" @change="importBackup" class="hidden">
                </label>
                <button @click="resetData" class="bg-rose-50 text-rose-500 px-4 py-2 rounded-xl text-xs font-bold hover:bg-rose-100">RESET</button>
            </div>
        </header>

        <div class="bg-white p-6 rounded-3xl shadow-md border-2 border-indigo-100 mb-8">
            <h2 class="text-[10px] font-black text-indigo-600 uppercase mb-3 tracking-widest">Filter Periode Laporan</h2>
            <div class="flex flex-wrap items-end gap-4">
                <div class="flex-1 min-w-[140px]">
                    <label class="text-[9px] font-bold text-slate-400 uppercase">Mulai</label>
                    <input type="date" x-model="filter.start" @change="calculateLaporan" class="w-full border-2 border-slate-50 p-2.5 rounded-xl text-sm font-bold text-slate-600 outline-none focus:border-indigo-500">
                </div>
                <div class="flex-1 min-w-[140px]">
                    <label class="text-[9px] font-bold text-slate-400 uppercase">Sampai</label>
                    <input type="date" x-model="filter.end" @change="calculateLaporan" class="w-full border-2 border-slate-50 p-2.5 rounded-xl text-sm font-bold text-slate-600 outline-none focus:border-indigo-500">
                </div>
                <button @click="resetFilter" class="bg-slate-800 text-white px-6 py-3 rounded-xl text-[10px] font-bold hover:bg-indigo-600 uppercase transition-all shadow-lg">Lihat Semua Data</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-4">
                <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-200 sticky top-4">
                    <h2 class="font-black text-slate-800 mb-6 uppercase italic text-xl border-b pb-4">Input Transaksi</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="text-[9px] font-bold text-slate-400 uppercase">Tanggal</label>
                            <input type="date" x-model="form.date" class="w-full border-2 border-slate-50 p-3 rounded-xl font-bold text-slate-600 outline-none focus:border-indigo-500 bg-slate-50">
                        </div>

                        <div>
                            <label class="text-[9px] font-bold text-slate-400 uppercase">Jenis Transaksi</label>
                            <select x-model="form.categoryKey" class="w-full border-2 border-indigo-50 p-3 rounded-xl text-xs font-bold bg-indigo-50 text-indigo-700 outline-none">
                                <option value="">-- PILIH --</option>
                                <template x-for="(cat, key) in smartCategories" :key="key">
                                    <option :value="key" x-text="cat.label"></option>
                                </template>
                            </select>
                        </div>

                        <div class="p-4 bg-slate-50 rounded-2xl space-y-3" x-show="form.categoryKey">
                            <label class="text-[9px] font-bold text-slate-400 uppercase" x-text="form.categoryKey === 'transfer' ? 'DARI' : 'AKUN KAS'"></label>
                            <select x-model="form.source" class="w-full border-2 border-white p-2 rounded-lg text-xs font-bold shadow-sm">
                                <template x-for="acc in coa.filter(a => a.type === 'Asset' && a.code.startsWith('1-1'))">
                                    <option :value="acc.code" x-text="acc.name"></option>
                                </template>
                            </select>
                            <div x-show="form.categoryKey === 'transfer'">
                                <label class="text-[9px] font-bold text-indigo-500 uppercase">KE</label>
                                <select x-model="form.target" class="w-full border-2 border-white p-2 rounded-lg text-xs font-bold shadow-sm">
                                    <template x-for="acc in coa.filter(a => a.type === 'Asset' && a.code.startsWith('1-1'))">
                                        <option :value="acc.code" x-text="acc.name"></option>
                                    </template>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="text-[9px] font-bold text-slate-400 uppercase">Nominal</label>
                            <input type="text" :value="formattedAmount" @input="updateAmount($event.target.value)" placeholder="Rp 0" class="w-full border-2 border-slate-50 p-4 rounded-xl font-black text-xl text-indigo-600 outline-none bg-slate-50">
                        </div>

                        <input type="text" x-model="form.desc" placeholder="Keterangan..." class="w-full border-2 border-slate-50 p-3 rounded-xl text-xs outline-none">
                        
                        <button @click="hardPost" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-black uppercase tracking-widest hover:bg-indigo-600 transition-all shadow-lg active:scale-95">POSTING</button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-6">
                <div class="flex flex-wrap gap-2 bg-white p-2 rounded-2xl shadow-sm border border-slate-200">
                    <template x-for="tab in ['Neraca & Laba Rugi', 'Arus Kas', 'Buku Besar', 'Umur Piutang', 'Modal']">
                        <button @click="activeTab = tab" :class="activeTab === tab ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-100'" class="px-5 py-2.5 rounded-xl text-[10px] font-black uppercase transition-all" x-text="tab"></button>
                    </template>
                </div>

                <div x-show="activeTab === 'Neraca & Laba Rugi'" class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white border-2 border-emerald-500 p-6 rounded-3xl">
                            <p class="text-[10px] font-bold text-emerald-600 uppercase mb-1">Pendapatan (Laba Kotor)</p>
                            <h3 class="text-2xl font-black text-slate-800" x-text="formatIDR(totalRevenue)"></h3>
                        </div>
                        <div class="bg-indigo-600 p-6 rounded-3xl text-white shadow-lg">
                            <p class="text-[10px] font-bold uppercase opacity-80 mb-1">Laba Bersih</p>
                            <h3 class="text-2xl font-black" x-text="formatIDR(totalRevenue - totalExpense)"></h3>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                        <h2 class="font-black text-slate-800 mb-4 uppercase text-xs border-l-4 border-slate-800 pl-3">Posisi Keuangan (Neraca)</h2>
                        <table class="w-full text-sm">
                            <template x-for="row in trialBalance" :key="row.code">
                                <tr class="border-b border-slate-50 hover:bg-slate-50">
                                    <td class="py-3 font-bold text-slate-600" x-text="row.name"></td>
                                    <td class="py-3 text-right font-black" :class="(row.type==='Asset'||row.type==='Expense') ? 'text-indigo-600' : 'text-rose-500'" x-text="formatIDR(row.debit > 0 ? row.debit : row.kredit)"></td>
                                </tr>
                            </template>
                        </table>
                    </div>
                </div>

                <div x-show="activeTab === 'Arus Kas'" class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="font-black text-slate-800 mb-6 uppercase text-xs border-l-4 border-blue-500 pl-3">Laporan Arus Kas</h2>
                    <div class="space-y-6">
                        <div class="flex justify-between items-center"><span class="font-bold text-slate-500">Uang Tunai Masuk (+)</span><span class="text-emerald-600 font-black text-lg" x-text="formatIDR(cashFlow.in)"></span></div>
                        <div class="flex justify-between items-center"><span class="font-bold text-slate-500">Uang Tunai Keluar (-)</span><span class="text-rose-500 font-black text-lg" x-text="formatIDR(cashFlow.out)"></span></div>
                        <div class="h-px bg-slate-100"></div>
                        <div class="flex justify-between items-center bg-slate-50 p-4 rounded-2xl"><span class="font-black text-slate-700">NET CASH CHANGE</span><span class="font-black text-xl" :class="cashFlow.net >= 0 ? 'text-emerald-600' : 'text-rose-600'" x-text="formatIDR(cashFlow.net)"></span></div>
                    </div>
                </div>

                <div x-show="activeTab === 'Buku Besar'" class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="font-black text-slate-800 uppercase text-xs border-l-4 border-purple-500 pl-3">Buku Besar</h2>
                        <select x-model="selectedGlAccount" class="border-2 border-slate-100 rounded-lg text-xs font-bold p-2 bg-slate-50">
                            <template x-for="acc in coa" :key="acc.code">
                                <option :value="acc.code" x-text="acc.name"></option>
                            </template>
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-xs">
                            <thead>
                                <tr class="bg-slate-50 text-slate-400 font-bold">
                                    <td class="p-3">TANGGAL</td><td class="p-3">KETERANGAN</td><td class="p-3 text-right">DEBIT</td><td class="p-3 text-right">KREDIT</td>
                                </tr>
                            </thead>
                            <template x-for="item in generalLedger" :key="item.id">
                                <tr class="border-b">
                                    <td class="p-3" x-text="item.date"></td>
                                    <td class="p-3 italic" x-text="item.desc || item.label"></td>
                                    <td class="p-3 text-right text-emerald-600 font-bold" x-text="item.dr > 0 ? formatIDR(item.dr) : '-'"></td>
                                    <td class="p-3 text-right text-rose-500 font-bold" x-text="item.cr > 0 ? formatIDR(item.cr) : '-'"></td>
                                </tr>
                            </template>
                        </table>
                    </div>
                </div>

                <div x-show="activeTab === 'Umur Piutang'" class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="font-black text-slate-800 mb-6 uppercase text-xs border-l-4 border-orange-500 pl-3">Analisis Umur Piutang (Aging)</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="p-6 bg-emerald-50 rounded-2xl border-2 border-emerald-100">
                            <p class="text-[9px] font-black text-emerald-600 uppercase mb-2">0-30 Hari</p>
                            <p class="text-xl font-black text-emerald-700" x-text="formatIDR(aging.current)"></p>
                        </div>
                        <div class="p-6 bg-amber-50 rounded-2xl border-2 border-amber-100">
                            <p class="text-[9px] font-black text-amber-600 uppercase mb-2">31-60 Hari</p>
                            <p class="text-xl font-black text-amber-700" x-text="formatIDR(aging.warn)"></p>
                        </div>
                        <div class="p-6 bg-rose-50 rounded-2xl border-2 border-rose-100">
                            <p class="text-[9px] font-black text-rose-600 uppercase mb-2">>60 Hari (Macet)</p>
                            <p class="text-xl font-black text-rose-700" x-text="formatIDR(aging.danger)"></p>
                        </div>
                    </div>
                </div>

                <div x-show="activeTab === 'Modal'" class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="font-black text-slate-800 mb-6 uppercase text-xs border-l-4 border-indigo-400 pl-3">Perubahan Modal</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between"><span>Setoran Modal Awal</span><span class="font-bold" x-text="formatIDR(equityReport.invest)"></span></div>
                        <div class="flex justify-between border-b pb-2"><span>Akumulasi Laba/Rugi</span><span class="font-bold text-emerald-600" x-text="formatIDR(totalRevenue - totalExpense)"></span></div>
                        <div class="flex justify-between p-4 bg-indigo-50 rounded-2xl font-black text-indigo-700"><span>TOTAL EKUITAS</span><span class="text-lg" x-text="formatIDR(equityReport.invest + (totalRevenue - totalExpense))"></span></div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 mt-6">
                    <h2 class="font-black text-slate-800 mb-4 uppercase text-xs border-l-4 border-slate-800 pl-3">Log Transaksi (Kronologis)</h2>
                    <div class="space-y-2 max-h-96 overflow-y-auto pr-2">
                        <template x-for="j in filteredJournal" :key="j.id">
                            <div class="p-4 bg-slate-50 rounded-2xl flex justify-between items-center border border-slate-100 hover:bg-white transition-all">
                                <div class="flex items-center gap-4">
                                    <button @click="deleteEntry(j.id)" class="text-slate-300 hover:text-rose-500">üóëÔ∏è</button>
                                    <div>
                                        <p class="text-[8px] font-black text-slate-400 uppercase" x-text="j.date"></p>
                                        <p class="font-black text-slate-700 text-sm" x-text="j.smartLabel"></p>
                                        <p class="text-[10px] text-slate-400 italic" x-text="j.desc"></p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-black text-indigo-600 text-sm" x-text="formatIDR(j.amount)"></p>
                                    <p class="text-[8px] text-slate-300 font-bold uppercase" x-text="j.debitAcc + ' ‚Üí ' + j.kreditAcc"></p>
                                </div>
                            </div>
                        </template>
                        <div x-show="filteredJournal.length === 0" class="text-center py-20 text-slate-300 italic text-sm">Tidak ada transaksi ditemukan untuk filter ini.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function accountingSystem() {
            return {
                coa: [
                    { code: "1-1100", name: "Kas Utama", type: "Asset" },
                    { code: "1-1200", name: "Bank", type: "Asset" },
                    { code: "1-1300", name: "Piutang Usaha", type: "Asset" },
                    { code: "2-1100", name: "Utang Usaha", type: "Liability" },
                    { code: "3-1100", name: "Modal Pemilik", type: "Equity" },
                    { code: "4-1100", name: "Pendapatan Jasa", type: "Revenue" },
                    { code: "5-1100", name: "Beban Operasional", type: "Expense" }
                ],
                smartCategories: {
                    income: { label: "PENDAPATAN TUNAI", dr: "fundSource", cr: "4-1100" },
                    expense: { label: "BIAYA OPERASIONAL", dr: "5-1100", cr: "fundSource" },
                    receivable_in: { label: "PEMBERIAN PIUTANG", dr: "1-1300", cr: "4-1100" },
                    receivable_pay: { label: "PELUNASAN PIUTANG", dr: "fundSource", cr: "1-1300" },
                    payable_in: { label: "PENAMBAHAN UTANG", dr: "5-1100", cr: "2-1100" },
                    payable_pay: { label: "PEMBAYARAN UTANG", dr: "2-1100", cr: "fundSource" },
                    transfer: { label: "TRANSFER / TARIK TUNAI", dr: "transferTo", cr: "fundSource" },
                    loan_in: { label: "TERIMA PINJAMAN", dr: "fundSource", cr: "2-1100" },
                    equity_in: { label: "SETORAN MODAL", dr: "fundSource", cr: "3-1100" }
                },
                form: { date: new Date().toISOString().split('T')[0], categoryKey: '', amount: 0, desc: '', source: '1-1100', target: '1-1200' },
                filter: { start: '', end: '' },
                activeTab: 'Neraca & Laba Rugi',
                journal: JSON.parse(localStorage.getItem('smart_acc_v14_3') || '[]'),
                filteredJournal: [],
                trialBalance: [], totalRevenue: 0, totalExpense: 0,
                selectedGlAccount: '1-1100',

                get formattedAmount() { return this.form.amount ? new Intl.NumberFormat('id-ID').format(this.form.amount) : ""; },
                updateAmount(val) { const clean = val.replace(/\D/g, ''); this.form.amount = clean ? parseInt(clean) : 0; },
                formatIDR(val) { return 'Rp ' + (val || 0).toLocaleString('id-ID'); },
                resetFilter() { this.filter.start = ''; this.filter.end = ''; this.calculateLaporan(); },

                init() { this.calculateLaporan(); },

                hardPost() {
                    if (!this.form.categoryKey || this.form.amount <= 0) return alert("Pilih kategori dan nominal!");
                    const cat = this.smartCategories[this.form.categoryKey];
                    this.journal.unshift({
                        id: Date.now(), date: this.form.date, smartLabel: cat.label, amount: this.form.amount, desc: this.form.desc,
                        debitAcc: (cat.dr === "fundSource") ? this.form.source : (cat.dr === "transferTo" ? this.form.target : cat.dr),
                        kreditAcc: (cat.cr === "fundSource") ? this.form.source : (cat.cr === "transferTo" ? this.form.target : cat.cr)
                    });
                    this.save();
                    this.form.amount = 0; this.form.desc = '';
                    this.calculateLaporan();
                },

                calculateLaporan() {
                    this.filteredJournal = this.journal.filter(j => {
                        const sOk = this.filter.start ? j.date >= this.filter.start : true;
                        const eOk = this.filter.end ? j.date <= this.filter.end : true;
                        return sOk && eOk;
                    });

                    let summary = {}; this.totalRevenue = 0; this.totalExpense = 0;
                    this.coa.forEach(a => summary[a.code] = { ...a, rawD: 0, rawK: 0 });
                    this.filteredJournal.forEach(j => { 
                        if(summary[j.debitAcc]) summary[j.debitAcc].rawD += j.amount; 
                        if(summary[j.kreditAcc]) summary[j.kreditAcc].rawK += j.amount; 
                    });

                    this.trialBalance = Object.values(summary).map(item => {
                        let d = 0, k = 0;
                        if (item.type === 'Asset' || item.type === 'Expense') {
                            let s = item.rawD - item.rawK; s >= 0 ? d = s : k = Math.abs(s);
                        } else {
                            let s = item.rawK - item.rawD; s >= 0 ? k = s : d = Math.abs(s);
                        }
                        if(item.type === 'Revenue') this.totalRevenue += (k - d);
                        if(item.type === 'Expense') this.totalExpense += (d - k);
                        return { ...item, debit: d, kredit: k };
                    }).filter(i => i.debit !== 0 || i.kredit !== 0);
                },

                get cashFlow() {
                    let cin = 0, cout = 0;
                    this.filteredJournal.forEach(j => {
                        const isCash = (acc) => acc === '1-1100' || acc === '1-1200';
                        if(isCash(j.debitAcc) && !isCash(j.kreditAcc)) cin += j.amount;
                        if(!isCash(j.debitAcc) && isCash(j.kreditAcc)) cout += j.amount;
                    });
                    return { in: cin, out: cout, net: cin - cout };
                },

                get generalLedger() {
                    return this.filteredJournal.filter(j => j.debitAcc === this.selectedGlAccount || j.kreditAcc === this.selectedGlAccount)
                        .map(j => ({
                            id: j.id, date: j.date, label: j.smartLabel, desc: j.desc,
                            dr: j.debitAcc === this.selectedGlAccount ? j.amount : 0,
                            cr: j.kreditAcc === this.selectedGlAccount ? j.amount : 0
                        }));
                },

                get aging() {
                    let cur = 0, warn = 0, danger = 0; const today = new Date();
                    this.journal.forEach(j => {
                        if(j.debitAcc === '1-1300' || j.kreditAcc === '1-1300') {
                            const diff = Math.floor((today - new Date(j.date)) / (86400000));
                            const val = j.debitAcc === '1-1300' ? j.amount : -j.amount;
                            if(diff <= 30) cur += val; else if(diff <= 60) warn += val; else danger += val;
                        }
                    });
                    return { current: Math.max(0, cur), warn: Math.max(0, warn), danger: Math.max(0, danger) };
                },

                get equityReport() {
                    let invest = 0;
                    this.journal.forEach(j => {
                        if(j.kreditAcc === '3-1100') invest += j.amount;
                        if(j.debitAcc === '3-1100') invest -= j.amount;
                    });
                    return { invest };
                },

                save() { localStorage.setItem('smart_acc_v14_3', JSON.stringify(this.journal)); },
                deleteEntry(id) { if(confirm("Hapus?")) { this.journal = this.journal.filter(j => j.id !== id); this.save(); this.calculateLaporan(); } },
                resetData() { if(confirm("Hapus semua?")) { localStorage.removeItem('smart_acc_v14_3'); location.reload(); } },
                downloadBackup() { const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(this.journal)); const dl = document.createElement('a'); dl.setAttribute("href", dataStr); dl.setAttribute("download", "BACKUP.json"); dl.click(); },
                importBackup(e) { 
                    const reader = new FileReader();
                    reader.onload = (ev) => { this.journal = JSON.parse(ev.target.result); this.save(); location.reload(); };
                    reader.readAsText(e.target.files[0]);
                }
            }
        }
    </script>
</body>

</html>
